<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lovable Referral Tester - Dashboard</title>
  <link rel="stylesheet" href="{{BASE_PATH}}/styles.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <h1>ğŸš€ Lovable Referral Tester</h1>
        <div class="header-status">
          <span class="status-indicator" id="connectionStatus">
            <span class="status-dot status-connecting"></span>
            Conectando...
          </span>
        </div>
      </div>
    </header>

    <!-- Stats Overview -->
    <section class="stats-overview">
      <div class="stat-card">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-content">
          <div class="stat-label">Total de Filas</div>
          <div class="stat-value" id="totalQueues">0</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">â–¶ï¸</div>
        <div class="stat-content">
          <div class="stat-label">Filas Ativas</div>
          <div class="stat-value" id="runningQueues">0</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">âœ…</div>
        <div class="stat-content">
          <div class="stat-label">Sucessos</div>
          <div class="stat-value" id="totalSuccess">0</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-content">
          <div class="stat-label">CrÃ©ditos Gerados</div>
          <div class="stat-value" id="totalCredits">0</div>
        </div>
      </div>
    </section>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Left Panel - Queues -->
      <section class="panel panel-queues">
        <div class="panel-header">
          <h2>ğŸ“‹ Filas de ExecuÃ§Ã£o</h2>
          <button class="btn btn-primary" onclick="app.showCreateQueueModal()">
            + Nova Fila
          </button>
        </div>
        
        <div class="queues-list" id="queuesList">
          <div class="empty-state">
            <p>Nenhuma fila criada ainda</p>
            <button class="btn btn-secondary" onclick="app.showCreateQueueModal()">
              Criar primeira fila
            </button>
          </div>
        </div>
      </section>

      <!-- History Panel -->
      <section class="panel panel-history">
        <div class="panel-header">
          <h2>ğŸ“š HistÃ³rico de ExecuÃ§Ãµes</h2>
          <button class="btn btn-small btn-secondary" onclick="app.clearHistory()">
            Limpar
          </button>
        </div>
        <div class="history-list" id="historyList">
          <div class="loading">Carregando histÃ³rico...</div>
        </div>
      </section>

      <!-- Metrics Panel -->
      <section class="panel panel-metrics">
        <div class="panel-header">
          <h2>ğŸ“Š MÃ©tricas (Sucessos e Erros)</h2>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-small btn-danger" onclick="app.clearMetrics()" title="Limpar todas as mÃ©tricas">
              ğŸ—‘ï¸ Limpar
            </button>
          </div>
        </div>
        <div class="metrics-content" id="metricsContent">
          <div class="loading">Carregando mÃ©tricas...</div>
        </div>
      </section>

      <!-- Recent Failures Panel -->
      <section class="panel panel-failures">
        <div class="panel-header">
          <h2>âŒ Falhas Recentes</h2>
        </div>
        <div class="failures-list" id="failuresList">
          <div class="loading">Carregando falhas...</div>
        </div>
      </section>

      <!-- Right Panel - Domains & Executions -->
      <aside class="sidebar">
        <!-- Logs Panel Toggle -->
        <section class="panel panel-logs-toggle">
          <button class="btn btn-secondary w-full" onclick="app.toggleLogs()">
            ğŸ“œ Mostrar/Ocultar Logs
          </button>
        </section>

        <!-- Active Executions -->
        <section class="panel panel-executions">
          <div class="panel-header">
            <h3>âš¡ ExecuÃ§Ãµes Ativas</h3>
            <span class="badge" id="activeExecutionsCount">0</span>
          </div>
          
          <div class="executions-list" id="executionsList">
            <div class="empty-state-small">
              Nenhuma execuÃ§Ã£o ativa
            </div>
          </div>
        </section>

        <!-- Domains - Temporariamente desativado -->
        <section class="panel panel-domains" style="display: none;">
          <div class="panel-header">
            <h3>ğŸ“§ DomÃ­nios de Email</h3>
            <button class="btn btn-small" onclick="app.showDomainsModal()">
              âš™ï¸
            </button>
          </div>
          
          <div class="domains-list" id="domainsList">
            <div class="loading">Carregando...</div>
          </div>
          
          <div class="domain-info">
            <p class="info-text">
              <strong>Atual:</strong> <span id="currentDomain">-</span>
            </p>
            <p class="info-text">
              <strong>Total:</strong> <span id="totalDomains">0</span>
            </p>
          </div>
        </section>

        <!-- Outlook Credentials -->
        <section class="panel panel-outlook">
          <div class="panel-header">
            <h3>ğŸ“¬ Credenciais Outlook</h3>
            <button class="btn btn-small" onclick="app.showOutlookModal()">
              âš™ï¸
            </button>
          </div>
          
          <div class="outlook-stats" id="outlookStats">
            <div class="loading">Carregando...</div>
          </div>
        </section>

        <!-- Referral Links -->
        <section class="panel panel-referral-links">
          <div class="panel-header">
            <h3>ğŸ”— Links de IndicaÃ§Ã£o</h3>
            <button class="btn btn-small" onclick="app.showReferralLinksModal()">
              âš™ï¸
            </button>
          </div>
          
          <div class="referral-links-stats" id="referralLinksStats">
            <div class="loading">Carregando...</div>
          </div>
        </section>
      </aside>
    </div>

    <!-- Logs Panel (Hidden by default) -->
    <div id="logsPanel" class="logs-panel hidden">
      <div class="logs-header">
        <h3>ğŸ“œ Logs do Sistema</h3>
        <div class="logs-actions">
          <button class="btn btn-small" onclick="app.clearLogs()">Limpar</button>
          <button class="btn btn-small" onclick="app.toggleLogs()">Fechar</button>
        </div>
      </div>
      <div class="logs-content" id="systemLogs" onscroll="app.checkLogsScrollPosition()">
        <!-- Logs serÃ£o inseridos aqui -->
      </div>
      <button id="scrollLogsDownBtn" class="scroll-down-btn" onclick="app.scrollLogsToBottom()" title="Ir para o final">
        â†“
      </button>
    </div>
  </div>

  <!-- Modal: Create Queue -->
  <div class="modal" id="createQueueModal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>ğŸš€ Nova Fila de ExecuÃ§Ã£o</h2>
        <button class="modal-close" onclick="app.hideCreateQueueModal()">Ã—</button>
      </div>
      
      <div class="modal-body">
        <form onsubmit="app.createQueue(event)" class="modal-form">
          <!-- SeÃ§Ã£o Principal -->
          <div class="form-section">
          <div class="form-group">
            <label for="queueReferralLink">ğŸ”— Link de IndicaÃ§Ã£o</label>
            <input 
              type="url" 
              id="queueReferralLink" 
              placeholder="https://lovable.dev/invite/XXXXXXX"
              required
            >
            <small>O link de indicaÃ§Ã£o da Lovable (obrigatÃ³rio)</small>
          </div>

          <div class="form-group">
            <label for="queueName">ğŸ“ Nome da Fila</label>
            <input 
              type="text" 
              id="queueName" 
              placeholder="Ex: Teste 10 indicaÃ§Ãµes"
              required
            >
          </div>
          
          <div class="form-row">
            <div class="form-group form-group-half">
              <label for="queueUsers">ğŸ‘¥ NÃºmero de UsuÃ¡rios</label>
              <input 
                type="number" 
                id="queueUsers" 
                min="1" 
                max="10000" 
                value="10"
                oninput="app.updateCreditsPreview(this.value); app.updateTimeEstimate();"
                required
              >
              <small>IndicaÃ§Ãµes a criar</small>
            </div>
            
            <div class="form-group form-group-half">
              <label for="queueParallel">âš¡ ExecuÃ§Ãµes Paralelas</label>
              <input 
                type="number" 
                id="queueParallel" 
                min="1" 
                max="10" 
                value="3"
                oninput="app.updateTimeEstimate()"
                required
              >
              <small>MÃ¡ximo: 10 simultÃ¢neas</small>
            </div>
          </div>
          
          <div class="credits-preview-box">
            <div class="credits-preview-icon">ğŸ’°</div>
            <div class="credits-preview-content">
              <div class="credits-preview-label">CrÃ©ditos que serÃ£o gerados</div>
              <div class="credits-preview-value" id="creditsPreview">100 crÃ©ditos</div>
              <div class="credits-preview-concurrent" id="creditsPreviewConcurrent" style="display: none; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(86, 171, 47, 0.3);">
                <div style="font-size: 11px; color: #56ab2f; margin-bottom: 4px;">Com requisiÃ§Ãµes ativadas:</div>
                <div style="font-size: 13px; color: #a8e063; font-weight: 600;" id="creditsPreviewConcurrentRange">de 600 a 750 crÃ©ditos</div>
              </div>
            </div>
          </div>

          <div class="credits-preview-box" style="margin-top: 12px; background: rgba(33, 150, 243, 0.1); border-color: rgba(33, 150, 243, 0.3); box-shadow: none;">
            <div class="credits-preview-icon" style="background: transparent !important; box-shadow: none !important; text-shadow: none !important; filter: none !important;">â±ï¸</div>
            <div class="credits-preview-content">
              <div class="credits-preview-label" style="color: #2196f3;">Tempo estimado de execuÃ§Ã£o</div>
              <div class="credits-preview-value" id="timeEstimatePreview" style="color: #64b5f6;">Calculando...</div>
              <div style="font-size: 10px; color: rgba(33, 150, 243, 0.7); margin-top: 4px;">
                Base: 1:30 por execuÃ§Ã£o â€¢ Margem de erro: 25% (30s por erro)
              </div>
            </div>
          </div>
        </div>

        <!-- SeÃ§Ã£o: OpÃ§Ãµes AvanÃ§adas -->
        <div class="form-section form-section-divider">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 class="form-section-title" style="margin: 0;">âš™ï¸ OpÃ§Ãµes AvanÃ§adas</h3>
            <button type="button" class="btn btn-tiny btn-secondary" onclick="app.enableAllOptions()" style="padding: 6px 12px; font-size: 11px;">
              âœ“ Ativar Todas
            </button>
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="queueForceCredits" class="checkbox-input" checked>
              <span class="checkbox-custom"></span>
              <div class="checkbox-content">
                <div class="checkbox-title">ğŸ’° Meta de CrÃ©ditos</div>
                <div class="checkbox-description">
                  O sistema continuarÃ¡ tentando atÃ© atingir a meta, criando novas tentativas automaticamente mesmo em caso de erros.
                </div>
              </div>
            </label>
          </div>

          <div class="form-group">
            <label class="checkbox-label" style="opacity: 0.5; cursor: not-allowed;">
              <input type="checkbox" id="queueTurboMode" class="checkbox-input" disabled onchange="app.onTurboModeChange()">
              <span class="checkbox-custom"></span>
              <div class="checkbox-content">
                <div class="checkbox-title">âš¡ Modo Turbo <span style="color: #ef4444; font-size: 10px;">(DESATIVADO TEMPORARIAMENTE)</span></div>
                <div class="checkbox-description">
                  ApÃ³s verificar o email, pula o quiz e a seleÃ§Ã£o de template, indo direto para o template fallback. Acelera significativamente a execuÃ§Ã£o.
                </div>
              </div>
            </label>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="queueCheckCreditsBanner" class="checkbox-input" checked>
              <span class="checkbox-custom"></span>
              <div class="checkbox-content">
                <div class="checkbox-title">ğŸ” Verificar Banner de CrÃ©ditos (Modo Turbo)</div>
                <div class="checkbox-description">
                  Procura o banner superior de 10 crÃ©ditos no editor antes de publicar. DisponÃ­vel apenas quando Modo Turbo estÃ¡ ativo. Se nÃ£o encontrar, gera erro na etapa final.
                </div>
              </div>
            </label>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="queueEnableConcurrentRequests" class="checkbox-input" checked onchange="app.onConcurrentRequestsChange()">
              <span class="checkbox-custom"></span>
              <div class="checkbox-content">
                <div class="checkbox-title">âš¡ Teste de RequisiÃ§Ãµes SimultÃ¢neas</div>
                <div class="checkbox-description">
                  Intercepta a requisiÃ§Ã£o de publicaÃ§Ã£o e faz mÃºltiplas requisiÃ§Ãµes simultÃ¢neas para testar bugs. Segue a mesma lÃ³gica da extensÃ£o Chrome.
                </div>
              </div>
            </label>
          </div>

          <div class="form-group" id="concurrentRequestsGroup" style="display: block; margin-left: 32px; margin-top: 12px; padding: 12px; background: rgba(86, 171, 47, 0.1); border: 1px solid rgba(86, 171, 47, 0.3); border-radius: 8px;">
            <label for="queueConcurrentRequests" style="display: block; font-weight: 600; margin-bottom: 8px; color: #a8e063;">
              ğŸ“Š NÃºmero de RequisiÃ§Ãµes SimultÃ¢neas
            </label>
            <input 
              type="number" 
              id="queueConcurrentRequests" 
              min="1" 
              max="1000" 
              value="100"
              required
              style="width: 100%; padding: 10px; border: 2px solid #56ab2f; border-radius: 6px; font-size: 16px; font-weight: bold; text-align: center; background: #0d0d0d; color: #a8e063;"
            >
            <small style="display: block; margin-top: 8px; color: #56ab2f; font-size: 12px;">
              ğŸ’¡ NÃºmero de requisiÃ§Ãµes simultÃ¢neas a fazer (padrÃ£o: 100 = 1000 crÃ©ditos estimados)
              <br>
              âš ï¸ A primeira requisiÃ§Ã£o Ã© a original, entÃ£o serÃ£o feitas (N-1) requisiÃ§Ãµes adicionais
              <br>
              ğŸ“Š MÃ¡ximo: 1000 requisiÃ§Ãµes (999 adicionais + 1 original)
            </small>
          </div>
        </div>

        <!-- SeÃ§Ã£o: ConfiguraÃ§Ãµes de Email e Proxy -->
        <div class="form-section form-section-divider">
          <h3 class="form-section-title">ğŸ“§ ConfiguraÃ§Ãµes de Email</h3>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="queueUseOutlook" class="checkbox-input" checked>
              <span class="checkbox-custom"></span>
              <div class="checkbox-content">
                <div class="checkbox-title">ğŸ“¬ Usar Modo Outlook (PadrÃ£o)</div>
                <div class="checkbox-description">
                  Usa credenciais do Outlook para criar contas. Se desmarcado, usa o mÃ©todo Inbound (ProxiedMail).
                </div>
              </div>
            </label>
          </div>
          
          <!-- DomÃ­nios e Proxies temporariamente desativados -->
          <div class="form-group" style="display: none;">
            <div class="form-group-header">
              <label>DomÃ­nios para esta Fila</label>
              <div class="form-group-actions">
                <button type="button" class="btn btn-tiny btn-secondary" onclick="app.selectAllDomains()">
                  âœ“ Todos
                </button>
                <button type="button" class="btn btn-tiny btn-secondary" onclick="app.clearDomainSelection()">
                  âœ— Nenhum
                </button>
              </div>
            </div>
            <small>Selecione quais domÃ­nios usar. Se nenhum for marcado, usa rotaÃ§Ã£o global.</small>
            <div id="queueDomainSelection" class="domain-selection-list">
              <!-- Checkboxes serÃ£o inseridos via JS -->
            </div>
          </div>

          <div class="form-group" style="display: none;">
            <div class="form-group-header">
              <label>ğŸŒ Proxies para esta Fila <span class="optional-badge">Opcional</span></label>
              <div class="form-group-actions">
                <button type="button" class="btn btn-tiny btn-secondary" onclick="app.selectAllProxies()">
                  âœ“ Todos
                </button>
                <button type="button" class="btn btn-tiny btn-secondary" onclick="app.clearProxySelection()">
                  âœ— Nenhum
                </button>
              </div>
            </div>
            <small class="warning-text">
              âš ï¸ Recomendado usar proxies apenas em muitas operaÃ§Ãµes paralelas. Para poucas execuÃ§Ãµes, usar IP local Ã© mais rÃ¡pido.
            </small>
            <div id="queueProxySelection" class="domain-selection-list">
              <!-- Checkboxes serÃ£o inseridos via JS -->
            </div>
          </div>
        </div>

        <!-- SeÃ§Ã£o: Testes -->
        <div class="form-section form-section-divider">
          <h3 class="form-section-title">ğŸ§ª Simular Erros (Para Testar)</h3>
          <small class="form-section-description">Selecione quais erros simular para testar os fallbacks do sistema.</small>
          
          <div id="queueErrorSimulation" class="error-simulation-list">
            <div class="error-checkbox">
              <input type="checkbox" id="simulate-template-error" value="template_error">
              <label for="simulate-template-error">
                <span class="error-checkbox-icon">âŒ</span>
                <div class="error-checkbox-content">
                  <div class="error-checkbox-title">Erro de Template</div>
                  <div class="error-checkbox-desc">Testa fallback para template especÃ­fico</div>
                </div>
              </label>
            </div>
            <div class="error-checkbox">
              <input type="checkbox" id="simulate-publish-error" value="publish_error">
              <label for="simulate-publish-error">
                <span class="error-checkbox-icon">âŒ</span>
                <div class="error-checkbox-content">
                  <div class="error-checkbox-title">Erro de Publish</div>
                  <div class="error-checkbox-desc">Testa retry com refresh</div>
                </div>
              </label>
            </div>
            <div class="error-checkbox">
              <input type="checkbox" id="simulate-email-error" value="email_error">
              <label for="simulate-email-error">
                <span class="error-checkbox-icon">âŒ</span>
                <div class="error-checkbox-content">
                  <div class="error-checkbox-title">Erro de Email</div>
                  <div class="error-checkbox-desc">Testa detecÃ§Ã£o de domÃ­nio cansado</div>
                </div>
              </label>
            </div>
          </div>
        </div>
        
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="app.hideCreateQueueModal()">
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary btn-large">
              âœ… Criar Fila
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal: Manage Domains -->
  <div class="modal" id="domainsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ“§ Gerenciar DomÃ­nios de Email</h2>
        <button class="modal-close" onclick="app.hideDomainsModal()">Ã—</button>
      </div>
      
      <div class="modal-body">
        <p class="info-text">
          Os domÃ­nios serÃ£o alternados de forma global. Se vocÃª tiver 2 domÃ­nios, 
          o primeiro usuÃ¡rio usarÃ¡ domÃ­nio1, o segundo domÃ­nio2, o terceiro domÃ­nio1, etc.
        </p>
        
        <div class="form-group">
          <label>DomÃ­nios Atuais</label>
          <div id="domainsEditor"></div>
        </div>
        
        <div class="form-group">
          <label for="newDomain">Adicionar Novo DomÃ­nio</label>
          <div class="input-group">
            <input 
              type="text" 
              id="newDomain" 
              placeholder="exemplo.com"
            >
            <button type="button" class="btn btn-primary" onclick="app.addDomain()">
              Adicionar
            </button>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="app.resetDomainIndex()">
            ğŸ”„ Resetar AlternÃ¢ncia
          </button>
          <button type="button" class="btn btn-primary" onclick="app.hideDomainsModal()">
            Fechar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Manage Outlook Credentials -->
  <div class="modal" id="outlookModal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>ğŸ“¬ Gerenciar Credenciais Outlook</h2>
        <button class="modal-close" onclick="app.hideOutlookModal()">Ã—</button>
      </div>
      
      <div class="modal-body">
        <p class="info-text">
          Adicione emails e senhas do Outlook que serÃ£o usados para criar contas no Lovable.
          O sistema aceita diferentes formatos de entrada.
        </p>
        
        <!-- EstatÃ­sticas -->
        <div class="outlook-stats-box" id="outlookModalStats">
          <div class="stat-item">
            <span class="stat-label">Total:</span>
            <span class="stat-value" id="outlookTotal">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Usadas:</span>
            <span class="stat-value" id="outlookUsed">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">DisponÃ­veis:</span>
            <span class="stat-value" id="outlookUnused">0</span>
          </div>
        </div>

        <!-- Abas -->
        <div class="tabs">
          <button class="tab-btn active" onclick="app.switchOutlookTab('import')" id="tabImport">
            ğŸ“¥ Importar Lista
          </button>
          <button class="tab-btn" onclick="app.switchOutlookTab('manual')" id="tabManual">
            âœï¸ Adicionar Manual
          </button>
          <button class="tab-btn" onclick="app.switchOutlookTab('list')" id="tabList">
            ğŸ“‹ Lista de Credenciais
          </button>
        </div>

        <!-- Aba: Importar Lista -->
        <div class="tab-content active" id="tabContentImport">
          <div class="form-group">
            <label for="outlookImportInput">Cole sua lista de emails e senhas:</label>
            <textarea 
              id="outlookImportInput" 
              rows="10" 
              placeholder="Exemplos de formatos aceitos:&#10;&#10;Email: raymondmerlinneala1@hotmail.com&#10;Senha: WeQxv9A8N3&#10;&#10;Email: raeelisefarah6@hotmail.com&#10;Senha: 9j5UcWGi3R&#10;&#10;Ou:&#10;email@hotmail.com,senha123&#10;email2@hotmail.com|senha456"
              style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-family: monospace; font-size: 13px; background: var(--bg-darker); color: var(--text-primary); resize: vertical;"
            ></textarea>
            <small style="display: block; margin-top: 8px; color: var(--text-secondary);">
              ğŸ’¡ O sistema detecta automaticamente diferentes formatos: "Email: ... Senha: ...", CSV, pipe (|), ou linhas separadas.
            </small>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn btn-primary" onclick="app.importOutlookCredentials()">
              ğŸ“¥ Importar Credenciais
            </button>
            <button type="button" class="btn btn-secondary" onclick="document.getElementById('outlookImportInput').value = ''">
              ğŸ—‘ï¸ Limpar
            </button>
          </div>
        </div>

        <!-- Aba: Adicionar Manual -->
        <div class="tab-content" id="tabContentManual">
          <div class="form-group">
            <label for="outlookEmail">Email:</label>
            <input 
              type="email" 
              id="outlookEmail" 
              placeholder="usuario@hotmail.com"
              style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-darker); color: var(--text-primary);"
            >
          </div>
          
          <div class="form-group">
            <label for="outlookPassword">Senha:</label>
            <input 
              type="password" 
              id="outlookPassword" 
              placeholder="Senha da conta"
              style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-darker); color: var(--text-primary);"
            >
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn btn-primary" onclick="app.addOutlookCredential()">
              â• Adicionar
            </button>
            <button type="button" class="btn btn-secondary" onclick="app.clearOutlookForm()">
              ğŸ—‘ï¸ Limpar
            </button>
          </div>
        </div>

        <!-- Aba: Lista de Credenciais -->
        <div class="tab-content" id="tabContentList">
          <div class="form-group">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <label>Credenciais Cadastradas:</label>
              <button type="button" class="btn btn-danger btn-small" onclick="app.clearAllOutlookCredentials()">
                ğŸ—‘ï¸ Limpar Todas
              </button>
            </div>
            <div id="outlookCredentialsList" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; padding: 12px; background: var(--bg-darker);">
              <div class="loading">Carregando...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Manage Referral Links -->
  <div class="modal" id="referralLinksModal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>ğŸ”— Gerenciar Links de IndicaÃ§Ã£o</h2>
        <button class="modal-close" onclick="app.hideReferralLinksModal()">Ã—</button>
      </div>
      
      <div class="modal-body">
        <p class="info-text">
          Visualize todos os links de indicaÃ§Ã£o que foram usados no sistema. 
          O limite recomendado Ã© de no mÃ¡ximo 10 usos por link.
        </p>
        
        <!-- EstatÃ­sticas -->
        <div class="outlook-stats-box" id="referralLinksModalStats">
          <div class="stat-item">
            <span class="stat-label">Total de Links:</span>
            <span class="stat-value" id="referralLinksTotal">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Links com 10+ usos:</span>
            <span class="stat-value" id="referralLinksExceeded" style="color: var(--warning);">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total de Usos:</span>
            <span class="stat-value" id="referralLinksTotalUsages">0</span>
          </div>
        </div>

        <!-- Lista de Links -->
        <div class="form-group">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <label>Links Cadastrados:</label>
            <button type="button" class="btn btn-danger btn-small" onclick="app.clearAllReferralLinks()">
              ğŸ—‘ï¸ Limpar Todos
            </button>
          </div>
          <div id="referralLinksList" style="max-height: 500px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; padding: 12px; background: var(--bg-darker);">
            <div class="loading">Carregando...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <p>Lovable Referral Tester - VersÃ£o <strong>2.0</strong></p>
      <button class="btn btn-danger" onclick="app.restartServer()" style="margin-left: 20px; padding: 8px 16px; font-size: 14px;" title="Parar tudo e reiniciar servidor">
        ğŸ”„ Reiniciar Servidor
      </button>
      <!-- BotÃ£o quase invisÃ­vel para download de CSV -->
      <button 
        id="csvDownloadBtn" 
        onclick="app.downloadCSV()" 
        style="
          margin-left: 20px; 
          padding: 2px 4px; 
          font-size: 10px; 
          opacity: 0.15;
          border: none;
          background: transparent;
          color: inherit;
          cursor: pointer;
          transition: opacity 0.2s;
        "
        onmouseover="this.style.opacity='0.5'"
        onmouseout="this.style.opacity='0.15'"
        title="Baixar CSV de histÃ³rico e contas"
      >
        ğŸ“¥ CSV
      </button>
    </div>
  </footer>

  <!-- Scripts -->
  <script>
    // Define BASE_PATH
    window.BASE_PATH = '{{BASE_PATH}}' || '';
  </script>
  <script src="{{BASE_PATH}}/socket.io/socket.io.js"></script>
  <script src="{{BASE_PATH}}/app.js"></script>
</body>
</html>

